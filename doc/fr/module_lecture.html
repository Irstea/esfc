<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="fr-fr"><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>Créer un module pour lire le contenu d'une fiche</title><meta content="Eric Quinton" name="author"><link rel="stylesheet" href="../../display/CSS/proto.css" type="text/css"></head>
<body><h1>Créer un module pour manipuler le contenu d'une fiche</h1>L'exemple est issu de identification/loginmodif.php.<br>Ce
module est unique pour gérer aussi bien la lecture des informations,
que la mise en fichier ou la suppression : c'est géré par la variable <span style="font-style: italic;">action</span>.<br><pre>$loginGestion = new LoginGestion($bdd,$ObjetBDDParam);<br>/**<br> * Récupération du type d'action<br> */<br>if (isset($_REQUEST["action"])){<br>	if ($_REQUEST["action"]=="M") {<br>		//Modification<br>		if (isset($_REQUEST["id"])) {<br>			$list=array();<br>			$list=$_REQUEST;<br>			$ret=$loginGestion-&gt;ecrire($list);<br></pre><p>Dans
cette partie modification, on charge le tableau $list avec les
variables transmises par le navigateur ($_REQUEST). Cette liste va être
transmise à l'objet LoginGestion, qui va s'occuper de préparer la
requête SQL de mise en fichier.</p><p>S'il s'agit d'un nouvel
enregistrement, la clé est passée à 0. De toute façon, le système
vérifie si l'enregistrement existe ou non avant de préparer la requête
d'écriture (commande insert ou update).I</p><pre>			if ($ret&gt;0) {<br>				$message= $LANG["message"][5];<br>				$_REQUEST["id"]=$ret;<br>			}else{<br>				$message=formatErrorData($loginGestion-&gt;getErrorData());<br>				$message.=$LANG["message"][12];<br>			}<br>		}<br><br>	}elseif ($_REQUEST["action"]=="S"&amp;&amp;$_REQUEST["id"]&gt;0) {<br>		//Suppression<br>		if($loginGestion-&gt;supprimer($_REQUEST["id"])==1) {<br>			$message=$LANG["message"][4];<br>			unset($_REQUEST["id"]);<br>			$module_coderetour = 1;<br>		}else{<br>			$message=$LANG["message"][13];<br>		}<br><br>	}elseif ($_REQUEST["action"]=="X"){<br>		$module_coderetour = 0;<br>	}<br>}<br>if (isset($_REQUEST["id"])) {<br>	$id = $_REQUEST['id'];<br>}<br><br>if (isset($id)){<br>	$list=$loginGestion-&gt;lire($id);<br></pre><p>Ici, lecture de l'enregistrement. Le contenu du tableau récupéré va être transmis à SMARTY, pour pouvoir être affiché.</p><pre>	$smarty-&gt;assign("list",$list);<br>	$smarty-&gt;assign("corps","ident/loginsaisie.tpl");<br>}else{<br>	$message=$LANG["message"][14];<br>}</pre><h3>La page display/templates/ident/loginsaisie.tpl</h3>C'est la page qui va être utilisée pour afficher le formulaire de saisie.<br><pre>&lt;script language="javascript" SRC="display/javascript/fonctions.js"&gt;&lt;/script&gt;<br></pre><p>Le
fichier fonctions.js contient les petites fonctions javascript
utilisées dans le formulaire, et notamment la vérification du mot de
passe ou la vérification de la volonté de l'utilisateur lors de la
suppression de l'enregistrement.</p><pre><br>&lt;form method="post" action="index.php"&gt;<br></pre><p>Le seul point d'entrée de l'application est la page index.php, qui est appelée systématiquement.</p><pre>&lt;input type="hidden" name="action" value="M"&gt; <br>&lt;input type="hidden" name="id" value="{$list.id}"&gt;<br>	&lt;input type="hidden" name="module" value="loginmodif"&gt;<br></pre><p>La variable <span style="font-style: italic;">module</span>
est obligatoire : c'est elle qui va permettre de savoir quel module
devra être appelé lorsque le formulaire sera validé. Consulter le
document décrivant le paramétrage d'un module.</p><pre>	&lt;input type="hidden" name="password" value="{$list.password}"&gt;<br></pre><p>Toutes
les valeurs contenues dans le tableau $list peuvent être affichées par
$list.nomattribut. Il existe également des possibilités de parcourir un
tableau quand il est multi-ligne : consulter à ce propos le fichier
display/templates/ident/loginliste.tpl.</p><pre><br>&lt;table class="tablesaisie"&gt;<br>	&lt;tr&gt;<br>		&lt;td&gt;{$LANG.login.0} :&lt;/td&gt;<br></pre><p>Les
libellés sont gérés dans un fichier à part, permettant une
internationalisation du logiciel : locales/fr.php. Consulter à cet
effet le document parlant de l'internationalisation de l'application.</p><pre>		&lt;td&gt;&lt;input name="login" value="{$list.login}"&gt;&lt;/td&gt;<br>	&lt;/tr&gt;<br>	&lt;tr&gt;<br>		&lt;td&gt;{$LANG.login.9} :&lt;/td&gt;<br>		&lt;td&gt;&lt;input name="nom" value="{$list.nom}"&gt;&lt;/td&gt;<br>	&lt;/tr&gt;<br>	&lt;tr&gt;<br>		&lt;td&gt;{$LANG.login.10} :&lt;/td&gt;<br>		&lt;td&gt;&lt;input name="prenom" value="{$list.prenom}"&gt;&lt;/td&gt;<br>	&lt;/tr&gt;<br>	&lt;tr&gt;<br>		&lt;td&gt;{$LANG.login.8} :&lt;/td&gt;<br>		&lt;td&gt;&lt;input name="mail" value="{$list.mail}"&gt;&lt;/td&gt;<br>	&lt;/tr&gt;<br>		&lt;tr&gt;<br>		&lt;td&gt;{$LANG.login.11} :&lt;/td&gt;<br>		&lt;td&gt;&lt;input name="datemodif" value="{$list.datemodif}"&gt;&lt;/td&gt;<br>	&lt;/tr&gt;<br>	<br>	&lt;tr&gt;<br>		&lt;td&gt;{$LANG.login.1} :&lt;/td&gt;<br>		&lt;td&gt;&lt;input type="password" name="pass1" onchange="verifieMdp(this.form.pass1, this.form.pass2)"&gt;&lt;/td&gt;<br>	&lt;/tr&gt;<br>	&lt;tr&gt;<br>		&lt;td&gt;{$LANG.login.12} :&lt;/td&gt;<br>		&lt;td&gt;&lt;input type="password" name="pass2" onchange="verifieMdp(this.form.pass1, this.form.pass2)"&gt;&lt;/td&gt;<br>	&lt;/tr&gt;<br>&lt;/table&gt;<br>&lt;div align="center"&gt;<br>&lt;input type="submit" name="valid" value="{$LANG.message.19}"/&gt;<br> &lt;input type="submit" name="suppr" value="{$LANG.message.20}" onClick="javascript:setAction(this.form, this.form.action,'S')"/&gt;<br> &lt;/div&gt;<br>&lt;/form&gt;<br></pre></body></html>